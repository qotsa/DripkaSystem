input {
  gelf {
    type => "gelf"
    port => 12201
  }

  tcp {
    type => "logback"
    port => 4560
    codec => json_lines
  }
}

filter {
  if [type] == "gelf" {
    multiline {
      pattern => "^%{TIMESTAMP_ISO8601}"
      negate => true
      what => "previous"
      source => "message"
    }

    grok {
      match => {
        "message" => "^%{TIMESTAMP_ISO8601:createdAt} \[%{USERNAME:thread}]%{SPACE}%{NOTSPACE:log_level}%{SPACE}%{NOTSPACE:class} - %{GREEDYDATA:log_message}\n*$"
      }
    }
  }

  if [type] == "logback" {

  }
}

output {
  if [type] == "gelf" {
    elasticsearch {
      hosts => ["elasticsearch:9200"]
      index => "logstash-%{+YYYY.MM.dd}"
    }
  }

  if [type] == "logback" {
    elasticsearch {
      hosts => ["elasticsearch:9200"]
      index => "logback-%{+YYYY.MM.dd}"
    }
  }
}